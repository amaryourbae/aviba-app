# aviba-app App Flow Document

## Onboarding and Sign-In/Sign-Up
When a new user first visits the applicationâ€™s root URL, the layout immediately checks for an existing session. If no valid session is found, the user is redirected to the sign-in page. On the sign-in page, a simple form requests an email address and password. If the user is new, they can click a link on this page to go to the sign-up screen. The sign-up page captures an email and a password and, on submission, sends these details in a POST request to the `/api/auth/sign-up` endpoint powered by Better Auth. The server validates the input, creates the user record in PostgreSQL via Drizzle ORM, establishes a session, and issues a secure session cookie before redirecting the user to the dashboard. Returning users use the sign-in form, which posts credentials to `/api/auth/sign-in`; upon successful authentication, they are also sent to the dashboard. If a user clicks the sign-out button from anywhere in the app, the client calls the Better Auth sign-out route at `/api/auth/sign-out`, which clears the session cookie and brings the user back to the sign-in page. Currently, there is no built-in password recovery or social login; any forgotten password must be reset manually in the database or added in a future update.

## Main Dashboard or Home Page
Once authenticated, the user lands on the dashboard at `/dashboard`. The dashboard is wrapped in its own layout that shares a site header at the top and a collapsible sidebar on the left. The site header displays the app logo, a theme toggle button, and a sign-out button. The sidebar contains a link to the dashboard itself and reserves space for future sections. The central content area is organized into distinct visual modules: an interactive chart panel, a data table listing static JSON rows, and a collection of summary cards. These modules demonstrate how dynamic data can appear and how user interactions like clicking a chart or sorting a table row would work in a full application. From this home view, users can switch themes, sign out, or click any additional links added to the sidebar to navigate to other parts of the app.

## Detailed Feature Flows and Page Transitions
When the user submits the sign-in or sign-up form, the client triggers the Next.js API route at `/api/auth/[...all]`. This single endpoint powered by Better Auth takes care of creating or validating user credentials, managing session cookies, and returning success or error responses. After a successful response, the Next.js router pushes the user to `/dashboard`. On the dashboard, each component handles its own interactions. The chart panel includes a button to open a modal dialog with more details; clicking that button mounts a Radix UI dialog component from `shadcn/ui` and overlays it on the page. The data table component allows the user to click column headers or rows to sort or highlight entries, though the current dataset is static. The section cards can expand or collapse content areas in place when clicked. The theme toggle in the header uses `next-themes` to switch between light, dark, and system preferences, immediately updating CSS variables across all components. Throughout the app, navigation occurs through client-side transitions managed by Next.js linking; clicking sidebar or header links updates the URL and loads the corresponding page or layout without a full browser refresh.

## Settings and Account Management
At present, the only user-configurable preference is the light or dark theme, controlled by the toggle in the site header. Toggling the theme writes the choice to local storage and applies the new color variables across the entire app via the `ThemeProvider`. There is no dedicated profile or settings page yet, so all account management consists of signing out with the button in the header. Future versions could introduce a profile page under the sidebar or header menu, where users could update personal information, change passwords, or manage subscription and billing settings.

## Error States and Alternate Paths
If a user enters an invalid email format or a password that fails validation on sign-up, inline error messages appear beneath the relevant form fields. Incorrect credentials on sign-in trigger a clear alert above the form. Network failures during form submission display a generic banner at the top asking the user to retry or check connectivity. When an unauthenticated user attempts to navigate directly to `/dashboard` or any other protected route, the root layout redirects them back to the sign-in page without exposing any content. Any unexpected server error in an API route surfaces as the built-in Next.js error page with a short message and a link to return to the dashboard or sign-in page, ensuring the user never sees raw stack traces.

## Conclusion and Overall App Journey
A typical user journey begins with landing on the app and being guided to the sign-in screen. They either register a new account or enter their existing credentials and upon success are brought into a secure dashboard environment. Once inside, they view interactive charts, tables, and cards, and can switch between light and dark mode at will. Signing out always returns them to the sign-in screen, completing the loop. Throughout this flow, the application relies on Next.js routing, Better Auth for session management, Drizzle ORM for database safety, and a consistent UI library to deliver a smooth, coherent experience from first visit to daily use.